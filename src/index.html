<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CC Version Guard</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://unpkg.com/@phosphor-icons/web@2.1.1"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Window Controls -->
  <div class="window-titlebar">
    <div class="window-drag-region"></div>
    <div class="window-controls">
      <button class="win-btn minimize" id="win-minimize" title="Minimize">
        <i class="ph ph-minus"></i>
      </button>
      <button class="win-btn maximize" id="win-maximize" title="Maximize">
        <i class="ph ph-squares-four"></i>
      </button>
      <button class="win-btn close" id="win-close" title="Close">
        <i class="ph ph-x"></i>
      </button>
    </div>
  </div>

  <div id="app">

    <!-- Progress Bar -->
    <div class="progress-bar">
      <div class="progress-step" data-step="1">
        <div class="step-dot"></div>
        <span>Start</span>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="2">
        <div class="step-dot"></div>
        <span>Select</span>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="3">
        <div class="step-dot"></div>
        <span>Options</span>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="4">
        <div class="step-dot"></div>
        <span>Done</span>
      </div>
    </div>

    <!-- Screen: Welcome -->
    <div id="screen-welcome" class="screen active">
      <div class="screen-content">
        <div class="icon-glow-ring accent">
          <i class="ph-fill ph-shield-check"></i>
        </div>
        <h1>CC Version Guard</h1>
        <p class="subtitle">Lock your CapCut version and prevent auto-updates.</p>

        <div class="feature-grid">
          <div class="feature-chip">
            <div class="chip-icon"><i class="ph-fill ph-lock-key"></i></div>
            <span>Block Updates</span>
          </div>
          <div class="feature-chip">
            <div class="chip-icon"><i class="ph-fill ph-trash"></i></div>
            <span>Clean Cache</span>
          </div>
          <div class="feature-chip">
            <div class="chip-icon"><i class="ph-fill ph-download-simple"></i></div>
            <span>Archive</span>
          </div>
        </div>

        <button class="btn-primary" onclick="startCheck()">
          <i class="ph-bold ph-play"></i> Start Protection
        </button>

        <a class="link-secondary" onclick="showScreen('download-manager')">
          <i class="ph ph-download-simple"></i> Download a Legacy Version
        </a>
      </div>
    </div>

    <!-- Screen: Download Manager -->
    <div id="screen-download-manager" class="screen">
      <div class="screen-content wide">
        <h2>Download Legacy Version</h2>
        <p class="subtitle">Choose from official ByteDance archives.</p>

        <div id="version-grid" class="version-grid">
          <!-- Populated by JS -->
        </div>

        <button class="btn-secondary" onclick="showScreen('welcome')">
          <i class="ph ph-arrow-left"></i> Back
        </button>
      </div>
    </div>

    <!-- Screen: PreCheck -->
    <div id="screen-precheck" class="screen">
      <div class="screen-content">
        <div class="icon-glow-ring">
          <i class="ph-fill ph-magnifying-glass spinning"></i>
        </div>
        <h2>Scanning System</h2>
        <p class="subtitle" id="precheck-status">Looking for CapCut installations...</p>
      </div>
    </div>

    <!-- Screen: CapCut Running -->
    <div id="screen-running-warning" class="screen">
      <div class="screen-content">
        <div class="icon-glow-ring warning">
          <i class="ph-fill ph-warning"></i>
        </div>
        <h2>CapCut is Running</h2>
        <p class="subtitle">Please close CapCut before continuing.</p>

        <button class="btn-primary" onclick="startCheck()">
          <i class="ph-bold ph-arrow-clockwise"></i> Check Again
        </button>
      </div>
    </div>

    <!-- Screen: Not Found -->
    <div id="screen-not-found" class="screen">
      <div class="screen-content">
        <div class="icon-glow-ring">
          <i class="ph-fill ph-folder-notch-open"></i>
        </div>
        <h2>CapCut Not Found</h2>
        <p class="subtitle">No installation detected on this system.</p>

        <button class="btn-primary" onclick="showScreen('download-manager')">
          <i class="ph-bold ph-download-simple"></i> Download a Version
        </button>

        <a class="link-secondary" onclick="startCheck()">
          <i class="ph ph-arrow-clockwise"></i> Scan Again
        </a>
      </div>
    </div>

    <!-- Screen: Version Select -->
    <div id="screen-version-select" class="screen">
      <div class="screen-content">
        <div class="icon-glow-ring accent">
            <i class="ph-fill ph-circles-four"></i>
        </div>
        <h2>Select Version</h2>
        <p class="subtitle">Choose which version to preserve.</p>

        <div class="instruction-row">
            <i class="ph-fill ph-info"></i>
            <span>All other versions will be removed.</span>
        </div>

        <div id="installed-versions" class="version-list">
          <!-- Populated by JS -->
        </div>

        <button id="btn-continue-select" class="btn-primary" disabled onclick="goToCacheScreen()">
          <i class="ph-bold ph-arrow-right"></i> Continue
        </button>

        <a class="link-secondary" onclick="showScreen('welcome')">
          <i class="ph ph-arrow-left"></i> Back
        </a>
      </div>
    </div>

    <!-- Screen: Cache Clean Options -->
    <div id="screen-cache-clean" class="screen">
      <div class="screen-content">
        <div class="icon-glow-ring accent">
            <i class="ph-fill ph-broom"></i>
        </div>
        <h2>Cache Cleanup</h2>
        <p class="subtitle">Free up disk space by removing temporary files.</p>

        <div class="cache-card">
          <div class="cache-header">
            <div class="icon-glow-ring small accent">
                <i class="ph-fill ph-broom"></i>
            </div>
            <div class="cache-text">
                <span class="cache-label">Recoverable Space</span>
                <span class="cache-value" id="cache-size">0 MB</span>
            </div>
          </div>

          <label class="toggle-row">
            <div class="toggle-text">
                <span class="toggle-title">Clean Cache</span>
                <span class="toggle-desc">Remove temporary files during protection</span>
            </div>
            <div class="toggle-wrapper">
                <input type="checkbox" id="cache-toggle" checked />
                <span class="toggle-switch"></span>
            </div>
          </label>
        </div>

        <button class="btn-primary" onclick="startProtection()">
          <i class="ph-bold ph-shield-check"></i> Apply Protection
        </button>

        <a class="link-secondary" onclick="showScreen('version-select')">
          <i class="ph ph-arrow-left"></i> Back
        </a>
      </div>
    </div>

    <!-- Screen: Running -->
    <div id="screen-running" class="screen">
      <div class="screen-content">
        <div class="icon-glow-ring">
          <i class="ph-fill ph-gear spinning"></i>
        </div>
        <h2>Applying Protection</h2>
        <p class="subtitle" id="running-status">Preparing...</p>

        <div class="progress-container">
          <div class="progress-fill" id="progress-fill"></div>
        </div>

        <div id="action-log" class="action-log">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- Screen: Complete -->
    <div id="screen-complete" class="screen">
      <div class="screen-content">
        <div class="icon-glow-ring success big">
          <i class="ph-fill ph-shield-check"></i>
        </div>
        <h2>Protection Complete!</h2>
        <p class="subtitle" id="complete-text">Your CapCut installation is now protected.</p>

        <div class="success-grid">
          <div class="success-item">
            <i class="ph-fill ph-check-circle"></i>
            <span>Versions Cleaned</span>
          </div>
          <div class="success-item">
            <i class="ph-fill ph-lock-key"></i>
            <span>Config Locked</span>
          </div>
          <div class="success-item">
            <i class="ph-fill ph-prohibit"></i>
            <span>Updates Blocked</span>
          </div>
          <div class="success-item" id="cache-cleaned-row">
            <i class="ph-fill ph-trash"></i>
            <span>Cache Cleaned</span>
          </div>
        </div>

        <div class="actions">
          <button class="btn-secondary" onclick="window.location.reload()">
            <i class="ph-bold ph-arrow-counter-clockwise"></i> Start Over
          </button>
          <button class="btn-primary" onclick="window.close()">
            <i class="ph-bold ph-x"></i> Close
          </button>
        </div>

        <a class="link-secondary" onclick="openGitHub()">
          <i class="ph ph-github-logo"></i> View on GitHub
        </a>
      </div>
    </div>

    <!-- Screen: Error -->
    <div id="screen-error" class="screen">
      <div class="screen-content">
        <div class="icon-glow-ring error">
          <i class="ph-fill ph-warning-octagon"></i>
        </div>
        <h2>Something Went Wrong</h2>
        <p class="subtitle" id="error-text">An error occurred.</p>

        <button class="btn-primary" onclick="showScreen('welcome')">
          <i class="ph-bold ph-arrow-clockwise"></i> Try Again
        </button>
      </div>
    </div>

  </div>

  <script src="main.js"></script>
</body>
</html>
