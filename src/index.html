<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CC Version Guard</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://unpkg.com/@phosphor-icons/web@2.1.1"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- ========================================== -->
  <!-- QUICK FIX WIZARD (Default Entry Point)    -->
  <!-- ========================================== -->
  <div id="wizard-overlay">

    <!-- Step 1: Scanning -->
    <div id="wiz-step-1" class="wiz-screen active">
      <div class="wiz-content">
        <div class="wiz-icon-wrap">
          <i class="ph-fill ph-magnifying-glass wiz-icon spinning"></i>
        </div>
        <h1 class="wiz-title">Scanning Your System</h1>
        <p class="wiz-desc">Looking for CapCut installations...</p>
      </div>
    </div>

    <!-- Step 2: Choose Version -->
    <div id="wiz-step-2" class="wiz-screen">
      <div class="wiz-content">
        <div class="wiz-icon-wrap">
          <i class="ph-fill ph-list-checks wiz-icon"></i>
        </div>
        <h1 class="wiz-title">Choose Your Version</h1>
        <p class="wiz-desc">Select the version you want to KEEP and protect.</p>

        <div id="wiz-version-list" class="wiz-list">
          <!-- Populated by JS -->
        </div>

        <button id="wiz-protect-btn" class="wiz-btn-primary" disabled onclick="wizardProtect()">
          <i class="ph-bold ph-shield-check"></i>
          <span>Select a Version</span>
        </button>
      </div>

      <a class="wiz-link" onclick="showWizDownload()">
        <i class="ph ph-download-simple"></i> Download a legacy version instead
      </a>
    </div>

    <!-- Step 2b: Download (Alternative) -->
    <div id="wiz-step-download" class="wiz-screen">
      <div class="wiz-content" style="max-width: 450px">
        <div class="wiz-icon-wrap">
          <i class="ph-fill ph-cloud-arrow-down wiz-icon"></i>
        </div>
        <h1 class="wiz-title">Download Legacy Version</h1>
        <p class="wiz-desc">Choose from official ByteDance archive.</p>

        <div id="wiz-download-list" class="wiz-list">
          <!-- Populated by JS -->
        </div>

        <button id="wiz-download-btn" class="wiz-btn-primary" disabled onclick="wizardDownload()">
          <i class="ph-bold ph-download-simple"></i>
          <span>Select a Version</span>
        </button>
      </div>

      <a class="wiz-link" onclick="wizardGoToStep(2)">
        <i class="ph ph-arrow-left"></i> Back to installed versions
      </a>
    </div>

    <!-- Step 3: Applying -->
    <div id="wiz-step-3" class="wiz-screen">
      <div class="wiz-content">
        <div class="wiz-icon-wrap">
          <i class="ph-fill ph-gear wiz-icon spinning"></i>
        </div>
        <h1 class="wiz-title">Applying Protection</h1>
        <p class="wiz-desc" id="wiz-progress-text">Preparing...</p>

        <div class="wiz-progress-bar">
          <div id="wiz-progress-fill" class="wiz-progress-fill"></div>
        </div>
      </div>
    </div>

    <!-- Step 4: Done -->
    <div id="wiz-step-done" class="wiz-screen">
      <div class="wiz-content">
        <div class="wiz-icon-wrap success">
          <i class="ph-fill ph-shield-check wiz-icon"></i>
        </div>
        <h1 class="wiz-title">Protection Complete!</h1>
        <p class="wiz-desc" id="wiz-done-text">Your CapCut installation is now locked.</p>

        <div class="wiz-summary">
          <div class="wiz-summary-item"><i class="ph-fill ph-check-circle"></i> Configuration locked</div>
          <div class="wiz-summary-item"><i class="ph-fill ph-check-circle"></i> Update blocker active</div>
          <div class="wiz-summary-item"><i class="ph-fill ph-check-circle"></i> Cache cleaned</div>
        </div>

        <button class="wiz-btn-primary" onclick="window.close()">
          <i class="ph-bold ph-x"></i> Close
        </button>

        <a class="wiz-link mt-lg" onclick="enterDashboard()">
          <i class="ph ph-squares-four"></i> Advanced Settings (Dashboard)
        </a>
      </div>
    </div>

    <!-- Error State -->
    <div id="wiz-step-error" class="wiz-screen">
      <div class="wiz-content">
        <div class="wiz-icon-wrap error">
          <i class="ph-fill ph-warning-octagon wiz-icon"></i>
        </div>
        <h1 class="wiz-title">Something Went Wrong</h1>
        <p class="wiz-desc" id="wiz-error-text">An error occurred.</p>

        <button class="wiz-btn-primary" onclick="wizardRestart()">
          <i class="ph-bold ph-arrow-clockwise"></i> Try Again
        </button>
      </div>
    </div>

    <!-- No CapCut Found -->
    <div id="wiz-step-notfound" class="wiz-screen">
      <div class="wiz-content">
        <div class="wiz-icon-wrap">
          <i class="ph-fill ph-folder-notch-open wiz-icon"></i>
        </div>
        <h1 class="wiz-title">CapCut Not Found</h1>
        <p class="wiz-desc">No CapCut installation detected on your system.</p>

        <button class="wiz-btn-primary" onclick="showWizDownload()">
          <i class="ph-bold ph-download-simple"></i> Download a Version
        </button>

        <a class="wiz-link mt-lg" onclick="wizardRestart()">
          <i class="ph ph-arrow-clockwise"></i> Scan Again
        </a>
      </div>
    </div>

    <!-- CapCut Running -->
    <div id="wiz-step-running" class="wiz-screen">
      <div class="wiz-content">
        <div class="wiz-icon-wrap warning">
          <i class="ph-fill ph-warning wiz-icon"></i>
        </div>
        <h1 class="wiz-title">CapCut is Running</h1>
        <p class="wiz-desc">Please close CapCut before proceeding.</p>

        <button class="wiz-btn-primary" onclick="wizardRestart()">
          <i class="ph-bold ph-arrow-clockwise"></i> Check Again
        </button>
      </div>
    </div>

  </div>

  <!-- ========================================== -->
  <!-- DASHBOARD (Advanced Mode)                 -->
  <!-- ========================================== -->
  <div id="app-container" class="hidden">
    <nav id="sidebar">
      <div class="brand">
        <i class="ph-fill ph-shield-check"></i>
        <span>ONYX SHIELD</span>
      </div>

      <div class="nav-item active" onclick="router.navigate('dashboard')">
        <i class="ph ph-squares-four"></i>
        <span>Dashboard</span>
      </div>

      <div class="nav-item" onclick="router.navigate('my-versions')">
        <i class="ph ph-list-dashes"></i>
        <span>My Versions</span>
      </div>

      <div class="nav-item" onclick="router.navigate('library')">
        <i class="ph ph-bag"></i>
        <span>Library</span>
      </div>

      <div class="nav-item" onclick="router.navigate('cleaner')">
        <i class="ph ph-broom"></i>
        <span>Cleaner</span>
      </div>

      <div style="flex:1"></div>

      <div class="nav-item" onclick="window.close()">
        <i class="ph ph-sign-out"></i>
        <span>Exit</span>
      </div>
    </nav>

    <main id="content-area">

      <section id="view-dashboard" class="view-section active">
        <div class="status-orb-container">
          <div id="status-orb" class="status-orb">
            <i class="ph-fill ph-shield-check"></i>
          </div>
          <h2 id="status-text">System Protected</h2>
          <p class="text-muted text-sm" id="status-sub">Configuration locked â€¢ Blocker active</p>
        </div>

        <div class="dashboard-grid">
          <div class="card">
            <span class="card-title">Active Version</span>
            <span class="card-value" id="dash-active-ver">--</span>
            <span class="card-sub text-success">Running</span>
          </div>

          <div class="card">
            <span class="card-title">Installed</span>
            <span class="card-value" id="dash-install-count">0</span>
            <span class="card-sub">Versions managed</span>
          </div>

          <div class="card">
            <span class="card-title">Cache</span>
            <span class="card-value" id="dash-cache-size">0 MB</span>
            <span class="card-sub">Recoverable space</span>
          </div>

          <div class="card" onclick="router.navigate('library')" style="cursor:pointer">
            <span class="card-title">Library</span>
            <span class="card-value text-accent">Browse</span>
            <span class="card-sub">Download versions</span>
          </div>
        </div>
      </section>

      <section id="view-my-versions" class="view-section">
        <h2 class="mb-lg">My Versions</h2>
        <div id="installed-list"></div>
      </section>

      <section id="view-library" class="view-section">
        <h2 class="mb-lg">Version Library</h2>
        <p class="text-muted mb-md">Download legacy versions directly from official servers.</p>
        <div id="library-grid" class="dashboard-grid"></div>
      </section>

      <section id="view-cleaner" class="view-section">
        <h2 class="mb-lg">Cache Cleaner</h2>
        <div class="card mb-lg">
          <span class="card-title">Total Cache Size</span>
          <span class="card-value" id="cleaner-size">0.0 MB</span>
          <p class="text-muted mt-sm">Includes proxy files, temp data, and smart crop cache.</p>
        </div>
        <button class="btn btn-primary w-full" onclick="runCleaner()">
          <i class="ph-bold ph-broom"></i> Clean All Cache
        </button>
      </section>

    </main>
  </div>

  <!-- Safety Modal (shared) -->
  <div id="safety-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="text-center mb-lg">
        <i class="ph-fill ph-warning-octagon text-warning" style="font-size: 48px"></i>
        <h3 class="mt-md">Compatibility Warning</h3>
      </div>

      <p class="mb-md text-muted">
        Opening projects in a newer version makes them <strong>permanently incompatible</strong> with older versions.
      </p>

      <p class="mb-lg text-muted">
        If you switch back to an older version later, these projects <strong>will not open</strong>.
      </p>

      <div style="display:flex; gap:10px; flex-direction:column">
        <button class="btn" style="padding:12px" onclick="openProjectsFolder()">
          <i class="ph ph-folder-open"></i> Backup Projects Folder First
        </button>

        <div style="display:flex; gap:10px; margin-top:10px">
          <button class="btn w-full" onclick="closeModal()">Cancel</button>
          <button class="btn btn-primary w-full" onclick="confirmSwitch()">I Understand, Switch</button>
        </div>
      </div>
    </div>
  </div>

  <script src="main.js"></script>
</body>
</html>
